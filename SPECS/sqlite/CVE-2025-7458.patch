From e4a1a8f14140d7029d69aadb1bc3139a07b24e2f Mon Sep 17 00:00:00 2001
From: Madhur Aggarwal <madaggarwal@microsoft.com>
Date: Thu, 31 Jul 2025 06:08:38 +0000
Subject: [PATCH] Patch CVE-2025-7458

Upstream Patch Reference: https://sqlite.org/src/vpatch?from=e4b6eb58e65f7fa0&to=12ad822d9b827777
---
 sqlite3.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/sqlite3.c b/sqlite3.c
index 158d416..b375786 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -158940,6 +158940,10 @@ static int wherePathSolver(WhereInfo *pWInfo, LogEst nRowEst){
       if( pFrom->isOrdered==pWInfo->pOrderBy->nExpr ){
         pWInfo->eDistinct = WHERE_DISTINCT_ORDERED;
       }
+      if( pWInfo->pSelect->pOrderBy
+       && pWInfo->nOBSat > pWInfo->pSelect->pOrderBy->nExpr ){
+        pWInfo->nOBSat = pWInfo->pSelect->pOrderBy->nExpr;
+      }
     }else{
       pWInfo->revMask = pFrom->revLoop;
       if( pWInfo->nOBSat<=0 ){
-- 
2.45.4

